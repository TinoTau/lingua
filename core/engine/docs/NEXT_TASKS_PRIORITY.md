# 待完成任务和优先级

## 📊 当前状态

### ✅ 已完成模块

1. **NMT 翻译模块** - ✅ 100% 完成
   - ✅ 真实 ONNX 推理实现
   - ✅ KV Cache 优化（已根据 `marian_nmt_interface_spec.md` 修复）
   - ✅ 完整测试套件
   - ✅ 已集成到 CoreEngine

2. **ASR Whisper 模块** - ✅ 96% 完成
   - ✅ 完整实现（推理、流式、VAD 集成）
   - ✅ 完整测试覆盖
   - ✅ 已集成到 CoreEngine
   - ⚠️ 少量优化待完成（性能、错误处理）

---

## 🎯 待完成任务（按优先级）

### 🔴 P0 - 高优先级（必须完成，阻塞后续开发）

**当前无 P0 任务** ✅

---

### 🟡 P1 - 中优先级（重要，但不阻塞）

#### 2. ASR Whisper 优化和增强
- **任务 ID**: `asr-optimization`
- **状态**: ⚠️ 部分完成
- **任务**:
  - [ ] 性能优化（内存使用、推理速度）
  - [ ] 日志和监控增强
  - [ ] 错误处理完善
- **预计时间**: 4-6 小时
- **优先级原因**: 提升用户体验，但不影响核心功能

#### 3. Emotion 适配器实现
- **任务 ID**: `emotion-1`, `emotion-2`, `emotion-3`
- **状态**: ❌ 未开始（仅 trait 定义）
- **文件**: `core/engine/src/emotion_adapter/`
- **任务**:
  - [ ] 集成 XLM-R ONNX 模型（加载和推理）
  - [ ] 实现 `EmotionAdapter` trait（情感分类逻辑）
  - [ ] 添加 Emotion 测试用例
- **预计时间**: 3-5 天
- **优先级原因**: 完整业务流程的一部分

#### 4. Persona 适配器实现
- **任务 ID**: `persona-1`, `persona-2`
- **状态**: ❌ 未开始（仅 trait 定义）
- **文件**: `core/engine/src/persona_adapter/mod.rs`
- **任务**:
  - [ ] 实现 `PersonaAdapter` trait（文本个性化规则/模板）
  - [ ] 添加 Persona 测试用例
- **预计时间**: 2-3 天
- **优先级原因**: 完整业务流程的一部分

#### 5. TTS 合成实现
- **任务 ID**: `tts-1`, `tts-2`, `tts-3`, `tts-4`
- **状态**: ❌ 未开始（仅 trait 定义）
- **文件**: `core/engine/src/tts_streaming/`
- **任务**:
  - [ ] 集成 FastSpeech2 + HiFiGAN 模型
  - [ ] 实现 `TtsStreaming` trait（PCM 音频生成）
  - [ ] 实现流式音频输出（chunk 拼接）
  - [ ] 添加 TTS 测试用例（输出 WAV 文件验证）
- **预计时间**: 7-11 天
- **优先级原因**: 完整业务流程的最后一步

---

### 🟢 P2 - 低优先级（可选/优化）

#### 6. WASM 构建环境准备
- **任务 ID**: `wasm-1` 到 `wasm-7`
- **状态**: ❌ 未开始
- **任务**:
  - [ ] 安装 wasm32 目标
  - [ ] 配置 wasm-bindgen/wasm-pack
  - [ ] 处理模型文件在浏览器中的加载方式
  - [ ] 添加 WASM 绑定到 CoreEngine
  - [ ] 实现 WASM 接口
  - [ ] 实现事件序列化
  - [ ] Node 环境测试
- **预计时间**: 7-12 天
- **优先级原因**: 需要先完成本地环境的所有模块

#### 7. Chrome 插件集成
- **任务 ID**: `chrome-1` 到 `chrome-8`
- **状态**: ❌ 未开始
- **任务**:
  - [ ] 更新 TypeScript runtime（WASM 加载）
  - [ ] 实现模型文件加载器
  - [ ] 替换 stub wasm 为真实 wasm
  - [ ] 实现 Popup UI
  - [ ] 实现 Options 设置页
  - [ ] 实现 Overlay/字幕层
  - [ ] 实现错误处理与降级
  - [ ] 编写 E2E 测试
- **预计时间**: 15-25 天
- **优先级原因**: 需要先完成 WASM 构建

---

## 📋 推荐执行顺序

### 第一阶段：完善核心功能（1-2 周）

1. **Emotion 适配器实现** (P1) ⭐ **推荐优先**
   - 完成情感分类功能
   - 预计时间：3-5 天

2. **Persona 适配器实现** (P1)
   - 完成文本个性化功能
   - 预计时间：2-3 天

3. **ASR Whisper 优化** (P1) - 可选
   - 性能优化和错误处理
   - 预计时间：1 天

**小计**: 6-9 天

---

### 第二阶段：完成 TTS 模块（1-2 周）

5. **TTS 合成实现** (P1)
   - 完成音频合成功能
   - 预计时间：7-11 天

**小计**: 7-11 天

---

### 第三阶段：WASM 构建（2-3 周）

6. **WASM 构建环境准备** (P2)
   - 搭建 WASM 构建环境
   - 预计时间：7-12 天

**小计**: 7-12 天

---

### 第四阶段：Chrome 插件集成（3-4 周）

7. **Chrome 插件集成** (P2)
   - 完成浏览器端集成
   - 预计时间：15-25 天

**小计**: 15-25 天

---

## 📊 任务统计

### 按优先级统计

| 优先级 | 任务数 | 预计时间 | 状态 |
|--------|--------|----------|------|
| 🔴 P0（高） | 0 | - | ✅ 全部完成 |
| 🟡 P1（中） | 4 | 13-20 天 | ⚠️ 部分完成 |
| 🟢 P2（低） | 2 | 22-37 天 | ❌ 未开始 |
| **总计** | **6** | **35-57 天** | - |

### 按模块统计

| 模块 | 任务数 | 预计时间 | 完成度 |
|------|--------|----------|--------|
| NMT | 0 | - | 100% ✅ |
| ASR | 1 | 1 天 | 96% ✅ |
| Emotion | 3 | 3-5 天 | 5% ❌ |
| Persona | 2 | 2-3 天 | 5% ❌ |
| TTS | 4 | 7-11 天 | 5% ❌ |
| WASM | 7 | 7-12 天 | 0% ❌ |
| Chrome | 8 | 15-25 天 | 0% ❌ |

---

## 🎯 立即行动项

### 本周建议完成

1. **Emotion 适配器实现** (P1) ⭐ **推荐优先**
   - 开始实现情感分类功能
   - 可以先完成模型加载和基础推理
   - 预计时间：3-5 天

### 下周建议完成

3. **Persona 适配器实现** (P1)
   - 完成文本个性化功能

4. **ASR Whisper 优化** (P1)
   - 性能优化和错误处理完善

---

## 📝 注意事项

1. **NMT KV Cache 优化** ✅ 已完成（根据 `marian_nmt_interface_spec.md` 实现）
2. **Emotion 和 Persona**可以并行开发，不相互依赖
3. **TTS**是完整业务流程的最后一步，建议在 Emotion/Persona 完成后开始
4. **WASM 和 Chrome 集成**需要等所有本地模块完成后才能开始

---

**最后更新**: 2024-12-19

