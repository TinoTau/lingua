# VAD åŸºäºŽè¯­é€Ÿçš„è‡ªé€‚åº”è¾¹ç•Œè°ƒæ•´

## æ¦‚è¿°

é€šè¿‡åˆ†æžç”¨æˆ·çš„å½“å‰è¯­é€Ÿï¼ŒåŠ¨æ€è°ƒæ•´ VADï¼ˆè¯­éŸ³æ´»åŠ¨æ£€æµ‹ï¼‰çš„é™éŸ³é˜ˆå€¼ï¼Œä»¥ä¼˜åŒ–è¾¹ç•Œæ£€æµ‹çš„å‡†ç¡®åº¦ã€‚

## é—®é¢˜èƒŒæ™¯

### ä¸ºä»€ä¹ˆéœ€è¦è‡ªé€‚åº”è°ƒæ•´ï¼Ÿ

1. **å¿«è¯­é€Ÿç”¨æˆ·**ï¼š
   - å¥å­ä¹‹é—´åœé¡¿çŸ­ï¼ˆå¯èƒ½åªæœ‰ 200-300msï¼‰
   - å¦‚æžœé˜ˆå€¼è®¾ç½®è¿‡é•¿ï¼ˆå¦‚ 400msï¼‰ï¼Œä¼šå¯¼è‡´å¤šä¸ªå¥å­è¢«åˆå¹¶
   - **éœ€è¦æ›´çŸ­çš„é˜ˆå€¼**ï¼ˆå¦‚ 280msï¼‰

2. **æ…¢è¯­é€Ÿç”¨æˆ·**ï¼š
   - å¥å­ä¸­é—´å¯èƒ½æœ‰è¾ƒé•¿çš„æ€è€ƒåœé¡¿ï¼ˆå¯èƒ½ 500-800msï¼‰
   - å¦‚æžœé˜ˆå€¼è®¾ç½®è¿‡çŸ­ï¼ˆå¦‚ 400msï¼‰ï¼Œä¼šåœ¨å¥å­ä¸­é—´å°±åˆ‡æ–­
   - **éœ€è¦æ›´é•¿çš„é˜ˆå€¼**ï¼ˆå¦‚ 520msï¼‰

3. **æ­£å¸¸è¯­é€Ÿç”¨æˆ·**ï¼š
   - å¥å­ä¹‹é—´åœé¡¿é€‚ä¸­ï¼ˆçº¦ 400-600msï¼‰
   - ä½¿ç”¨é»˜è®¤é˜ˆå€¼å³å¯

## å®žçŽ°æ–¹æ¡ˆ

### 1. è¯­é€Ÿè®¡ç®—

åœ¨ ASR è¯†åˆ«å®ŒæˆåŽï¼Œè®¡ç®—è¯­é€Ÿï¼š

```rust
speech_rate = å­—ç¬¦æ•° / éŸ³é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰
```

- **å•ä½**ï¼šå­—ç¬¦/ç§’
- **æ­£å¸¸èŒƒå›´**ï¼š3-12 å­—ç¬¦/ç§’
- **å¿«è¯­é€Ÿ**ï¼š> 8 å­—ç¬¦/ç§’
- **æ…¢è¯­é€Ÿ**ï¼š< 4 å­—ç¬¦/ç§’

### 2. è¯­é€ŸåŽ†å²è®°å½•

- ä¿ç•™æœ€è¿‘ **20 ä¸ªæ ·æœ¬**çš„è¯­é€ŸåŽ†å²
- ä½¿ç”¨**æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡ï¼ˆEWMAï¼‰**è®¡ç®—å¹³å‡è¯­é€Ÿ
  - æœ€è¿‘çš„å€¼æƒé‡æ›´é«˜ï¼ˆalpha = 0.3ï¼‰
  - èƒ½å¤Ÿå¿«é€Ÿå“åº”è¯­é€Ÿå˜åŒ–

### 3. é˜ˆå€¼è°ƒæ•´ç­–ç•¥

ä½¿ç”¨ **sigmoid å‡½æ•°**å®žçŽ°å¹³æ»‘çš„è¿žç»­è°ƒæ•´ï¼ˆè€Œéžåˆ†æ®µå‡½æ•°ï¼‰ï¼š

```rust
// å°†è¯­é€Ÿæ˜ å°„åˆ° [-2, 2] èŒƒå›´
normalized_rate = (avg_speech_rate - 6.0) / 2.0
sigmoid_value = sigmoid(normalized_rate)

// è®¡ç®—å€æ•°
multiplier = 1.0 + (0.5 - sigmoid_value) * 0.4
multiplier = multiplier.clamp(0.5, 1.5)  // é™åˆ¶åœ¨ 0.5-1.5 å€
```

**è°ƒæ•´æ•ˆæžœ**ï¼š
- è¯­é€Ÿ = 2 å­—ç¬¦/ç§’ â†’ multiplier â‰ˆ 1.4ï¼ˆå»¶é•¿ 40%ï¼‰
- è¯­é€Ÿ = 6 å­—ç¬¦/ç§’ â†’ multiplier â‰ˆ 1.0ï¼ˆä¿æŒåŽŸå€¼ï¼‰
- è¯­é€Ÿ = 10 å­—ç¬¦/ç§’ â†’ multiplier â‰ˆ 0.6ï¼ˆç¼©çŸ­ 40%ï¼‰

### 4. å¹³æ»‘æ›´æ–°

ä½¿ç”¨**å¹³æ»‘æ›´æ–°**é¿å…é˜ˆå€¼çªå˜ï¼š

```rust
target_duration = base_threshold * multiplier
adjustment = (target_duration - current_duration) * adaptive_rate
new_duration = current_duration + adjustment
```

- `adaptive_rate = 0.2`ï¼ˆæ¯æ¬¡è°ƒæ•´ 20%ï¼‰
- é™åˆ¶åœ¨ `[adaptive_min_duration_ms, adaptive_max_duration_ms]` èŒƒå›´å†…

## é…ç½®å‚æ•°

```rust
pub struct SileroVadConfig {
    min_silence_duration_ms: 400,      // åŸºç¡€é˜ˆå€¼ï¼š400ms
    adaptive_enabled: true,             // å¯ç”¨è‡ªé€‚åº”
    adaptive_min_samples: 3,            // è‡³å°‘3ä¸ªæ ·æœ¬æ‰å¼€å§‹è°ƒæ•´
    adaptive_rate: 0.2,                 // æ¯æ¬¡è°ƒæ•´20%
    adaptive_min_duration_ms: 250,      // æœ€å°é˜ˆå€¼ï¼š250ms
    adaptive_max_duration_ms: 1200,     // æœ€å¤§é˜ˆå€¼ï¼š1200ms
}
```

## å·¥ä½œæµç¨‹

### å•ä¸ªçŸ­å¥çš„å¤„ç†æµç¨‹

1. **VAD æ£€æµ‹è¾¹ç•Œ**ï¼š
   - ä½¿ç”¨å½“å‰è¯´è¯è€…çš„è‡ªé€‚åº”é˜ˆå€¼ï¼ˆå¦‚æžœå·²è®¡ç®—ï¼‰
   - å¦‚æžœæ ·æœ¬ä¸è¶³ï¼Œä½¿ç”¨åŸºç¡€é˜ˆå€¼ï¼ˆ400msï¼‰

2. **è¯´è¯è€…è¯†åˆ«**ï¼š
   - è¯†åˆ«å½“å‰è¯´è¯è€…
   - è®¾ç½® `current_speaker_id`ï¼ˆç”¨äºŽåŽç»­é˜ˆå€¼è¯»å–ï¼‰

3. **ASR è¯†åˆ«**ï¼š
   - è¯†åˆ«å®ŒæˆåŽï¼Œè®¡ç®—è¯­é€Ÿ
   - è°ƒç”¨ `update_speaker_speech_rate()` æ›´æ–°è¯­é€ŸåŽ†å²
   - **ç«‹å³æ›´æ–°é˜ˆå€¼**ï¼ˆåŒæ­¥æ“ä½œï¼Œæ— å»¶è¿Ÿï¼‰

4. **ä¸‹ä¸€ä¸ªçŸ­å¥çš„è¾¹ç•Œæ£€æµ‹**ï¼š
   - **ç«‹å³ä½¿ç”¨æ›´æ–°åŽçš„é˜ˆå€¼**ï¼ˆæ¯æ¬¡ `detect()` éƒ½ä¼šè¯»å–æœ€æ–°çš„é˜ˆå€¼ï¼‰
   - æ— è®ºæ˜¯åŒä¸€ä¸ªè¯´è¯è€…è¿˜æ˜¯æ–°çš„è¯´è¯è€…ï¼Œéƒ½ä¼šä½¿ç”¨å¯¹åº”çš„é˜ˆå€¼

### å¤šè¯´è¯è€…åœºæ™¯

**å…³é”®ç‚¹**ï¼šæ¯ä¸ªçŸ­å¥è¯†åˆ«å®ŒæˆåŽï¼Œéƒ½ä¼šç«‹å³æ›´æ–°å¯¹åº”è¯´è¯è€…çš„è¯­é€Ÿï¼Œå¹¶åº”ç”¨åˆ°ä¸‹ä¸€ä¸ªçŸ­å¥ã€‚

```
çŸ­å¥1ï¼ˆè¯´è¯è€…Aï¼‰ï¼š
â”œâ”€ VAD æ£€æµ‹è¾¹ç•Œ â†’ ä½¿ç”¨ speaker_A çš„é˜ˆå€¼ï¼ˆå¦‚æžœæœ‰åŽ†å²ï¼Œå¦åˆ™é»˜è®¤400msï¼‰
â”œâ”€ è¯´è¯è€…è¯†åˆ« â†’ speaker_A
â”œâ”€ ASR è¯†åˆ« â†’ "Hello world" (11å­—ç¬¦, 1000ms)
â””â”€ æ›´æ–°è¯­é€Ÿ â†’ speaker_A: 11 chars/s â†’ é˜ˆå€¼æ›´æ–°ä¸º 280ms âœ…

çŸ­å¥2ï¼ˆè¯´è¯è€…Bï¼Œæ–°è¯´è¯è€…ï¼‰ï¼š
â”œâ”€ VAD æ£€æµ‹è¾¹ç•Œ â†’ ä½¿ç”¨ speaker_A çš„é˜ˆå€¼ï¼ˆ280msï¼‰âš ï¸
â”‚  â””â”€ æ³¨æ„ï¼šæ­¤æ—¶ speaker_B è¿˜æ²¡è¯†åˆ«ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸Šä¸€ä¸ªè¯´è¯è€…çš„é˜ˆå€¼
â”œâ”€ è¯´è¯è€…è¯†åˆ« â†’ speaker_Bï¼ˆæ–°è¯´è¯è€…ï¼‰
â”œâ”€ ASR è¯†åˆ« â†’ "Hi there" (8å­—ç¬¦, 800ms)
â””â”€ æ›´æ–°è¯­é€Ÿ â†’ speaker_B: 10 chars/s â†’ é˜ˆå€¼æ›´æ–°ä¸º 300ms âœ…
   â””â”€ speaker_B åˆ›å»ºæ–°çš„çŠ¶æ€ï¼Œä½¿ç”¨é»˜è®¤é˜ˆå€¼å¼€å§‹

çŸ­å¥3ï¼ˆè¯´è¯è€…Bç»§ç»­ï¼‰ï¼š
â”œâ”€ VAD æ£€æµ‹è¾¹ç•Œ â†’ ä½¿ç”¨ speaker_B çš„é˜ˆå€¼ï¼ˆ300msï¼‰âœ…
â”œâ”€ è¯´è¯è€…è¯†åˆ« â†’ speaker_B
â”œâ”€ ASR è¯†åˆ« â†’ "How are you" (11å­—ç¬¦, 1200ms)
â””â”€ æ›´æ–°è¯­é€Ÿ â†’ speaker_B: 9.2 chars/s â†’ é˜ˆå€¼æ›´æ–°ä¸º 310ms âœ…

çŸ­å¥4ï¼ˆè¯´è¯è€…Aç»§ç»­ï¼‰ï¼š
â”œâ”€ VAD æ£€æµ‹è¾¹ç•Œ â†’ ä½¿ç”¨ speaker_B çš„é˜ˆå€¼ï¼ˆ310msï¼‰âš ï¸
â”œâ”€ è¯´è¯è€…è¯†åˆ« â†’ speaker_A
â”œâ”€ ASR è¯†åˆ« â†’ "I'm fine" (7å­—ç¬¦, 600ms)
â””â”€ æ›´æ–°è¯­é€Ÿ â†’ speaker_A: 11.7 chars/s â†’ é˜ˆå€¼æ›´æ–°ä¸º 270ms âœ…
   â””â”€ speaker_A ç»§ç»­ä½¿ç”¨åŽ†å²æ•°æ®ï¼Œå¿«é€Ÿé€‚åº”
```

### åŠ¨æ€è°ƒæ•´çš„ä¿è¯

âœ… **æ¯ä¸ªçŸ­å¥éƒ½æ›´æ–°è¯­é€Ÿ**ï¼šASR è¯†åˆ«å®ŒæˆåŽç«‹å³æ›´æ–°ï¼ˆç¬¬ 413 è¡Œï¼‰

âœ… **ç«‹å³åº”ç”¨åˆ°ä¸‹ä¸€ä¸ªçŸ­å¥**ï¼š
- é˜ˆå€¼æ›´æ–°æ˜¯åŒæ­¥çš„ï¼ˆæ— å»¶è¿Ÿï¼‰
- ä¸‹ä¸€ä¸ªçŸ­å¥çš„ `VAD.detect()` ä¼šç«‹å³è¯»å–æœ€æ–°çš„é˜ˆå€¼ï¼ˆç¬¬ 551-553 è¡Œï¼‰

âœ… **æ¯ä¸ªè¯´è¯è€…ç‹¬ç«‹ç»´æŠ¤**ï¼š
- æ¯ä¸ªè¯´è¯è€…æœ‰è‡ªå·±çš„ `SpeakerAdaptiveState`
- è¯­é€Ÿæ›´æ–°åªå½±å“å¯¹åº”è¯´è¯è€…çš„é˜ˆå€¼

âœ… **æ–°è¯´è¯è€…å¿«é€Ÿé€‚åº”**ï¼š
- æ–°è¯´è¯è€…ä»Žé»˜è®¤é˜ˆå€¼å¼€å§‹
- 3 ä¸ªæ ·æœ¬åŽå¼€å§‹è‡ªé€‚åº”è°ƒæ•´
- 20% çš„è°ƒæ•´é€Ÿåº¦ï¼Œå¿«é€Ÿé€‚åº”

## ä¼˜åŠ¿

1. **å¹³æ»‘è°ƒæ•´**ï¼šä½¿ç”¨ sigmoid å‡½æ•°å®žçŽ°è¿žç»­è°ƒæ•´ï¼Œé¿å…çªå˜
2. **å¿«é€Ÿå“åº”**ï¼šEWMA å’Œè¾ƒé«˜çš„ adaptive_rateï¼ˆ20%ï¼‰ä½¿ç³»ç»Ÿèƒ½å¿«é€Ÿé€‚åº”è¯­é€Ÿå˜åŒ–
3. **ä¸ªæ€§åŒ–**ï¼šæ¯ä¸ªè¯´è¯è€…ç»´æŠ¤ç‹¬ç«‹çš„è‡ªé€‚åº”çŠ¶æ€
4. **ç¨³å®šæ€§**ï¼šå¹³æ»‘æ›´æ–°å’ŒèŒƒå›´é™åˆ¶ç¡®ä¿é˜ˆå€¼ä¸ä¼šè¿‡åº¦è°ƒæ•´

## æ—¥å¿—è¾“å‡º

```
[SileroVad] ðŸ“Š Speaker 'speaker_1': speech_rate=9.50 chars/s, threshold=280ms (base=400ms, 70.0%) [samples=5, update_time=0.123ms]
```

- `speech_rate`ï¼šå¹³å‡è¯­é€Ÿï¼ˆå­—ç¬¦/ç§’ï¼‰
- `threshold`ï¼šè°ƒæ•´åŽçš„é˜ˆå€¼ï¼ˆæ¯«ç§’ï¼‰
- `base`ï¼šåŸºç¡€é˜ˆå€¼ï¼ˆæ¯«ç§’ï¼‰
- `70.0%`ï¼šè°ƒæ•´æ¯”ä¾‹
- `samples`ï¼šæ ·æœ¬æ•°é‡
- `update_time`ï¼šæ›´æ–°è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰

## æœªæ¥ä¼˜åŒ–æ–¹å‘

1. **æ›´ç²¾ç»†çš„è¯­é€Ÿåˆ†æž**ï¼š
   - åŒºåˆ†å¥å­å†…åœé¡¿å’Œå¥å­é—´åœé¡¿
   - è€ƒè™‘è¯­è°ƒå˜åŒ–

2. **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**ï¼š
   - æ ¹æ®è¯†åˆ«ç½®ä¿¡åº¦è°ƒæ•´é˜ˆå€¼
   - ä½Žç½®ä¿¡åº¦æ—¶ï¼Œå¯èƒ½éœ€è¦æ›´é•¿çš„é˜ˆå€¼

3. **å¤šç»´åº¦è°ƒæ•´**ï¼š
   - ç»“åˆéŸ³é¢‘ç‰¹å¾ï¼ˆèƒ½é‡ã€é¢‘è°±ï¼‰
   - ç»“åˆè¯´è¯è€…ç‰¹å¾ï¼ˆéŸ³è°ƒã€éŸ³è‰²ï¼‰

