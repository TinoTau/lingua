# Lingua ASR 专用测试页面

## 功能说明

这是一个专门用于测试 ASR（语音识别）功能的简化 Web 前端，只包含：
- **实时音频流传输**：使用 Web Audio API 实时捕获麦克风音频
- **停顿识别**：VAD 实时检测语音边界（停顿）
- **文本识别**：ASR 实时识别语音文本

**不包含**：
- ❌ 翻译功能（NMT）
- ❌ 语音合成功能（TTS）

## 使用方法

### 1. 启动 CoreEngine 服务

确保 CoreEngine 服务正在运行（默认端口 9000）：

```bash
# 在 core/engine 目录下
cargo run --bin core_engine -- --config lingua_core_config.toml
```

**注意**：即使 NMT 和 TTS 服务未运行，ASR 功能仍然可以正常工作。

### 2. 启动 Web 前端服务器

```bash
# 在 clients/web_pwa 目录下
.\start_web_server.ps1
```

或者使用 Python：

```bash
python -m http.server 8080 --directory clients/web_pwa
```

### 3. 访问 ASR 测试页面

在浏览器中打开：
```
http://localhost:8080/index_asr_only.html
```

### 4. 开始测试

1. **配置服务地址**：确保服务地址指向 CoreEngine（默认 `http://127.0.0.1:9000`）
2. **选择源语言**：选择要识别的语言（中文、英文等）
3. **点击"开始实时录音"**：浏览器会请求麦克风权限
4. **开始说话**：系统会实时识别您的语音
5. **查看结果**：
   - **识别文本**：实时显示识别的文本
   - **统计信息**：显示总时长、检测到的停顿次数、识别文本次数
   - **调试日志**：显示详细的处理日志

## 测试要点

### 停顿识别测试

- 观察"检测到停顿"的次数
- 在说话时停顿，查看是否能够正确检测到边界
- 查看日志中的 `[边界 #N]` 信息

### 文本识别测试

- 观察"识别文本"的次数和内容
- 查看识别的文本是否准确
- 查看日志中的 `[识别 #N]` 信息

## WebSocket 端点

ASR 专用端点：`ws://127.0.0.1:9000/asr/stream`

### 消息格式

**客户端 → 服务器**：
```json
{
  "type": "audio_frame",
  "data": "base64编码的PCM音频数据",
  "timestamp_ms": 12345,
  "sample_rate": 16000,
  "channels": 1
}
```

```json
{
  "type": "config",
  "src_lang": "zh"
}
```

**服务器 → 客户端**：
```json
{
  "transcript": "识别的文本",
  "is_boundary": true
}
```

## 注意事项

1. **浏览器兼容性**：建议使用 Chrome、Firefox 或 Edge 浏览器
2. **麦克风权限**：首次使用需要授予麦克风权限
3. **服务要求**：只需要 CoreEngine 服务运行即可，不需要 NMT 和 TTS 服务
4. **环境要求**：建议在安静的环境中使用，以获得更好的识别效果

## 故障排除

### WebSocket 连接失败

- 检查 CoreEngine 服务是否运行（端口 9000）
- 检查服务地址是否正确
- 查看浏览器控制台的错误信息

### 没有识别结果

- 检查麦克风权限是否已授予
- 检查音频输入是否正常（查看浏览器控制台）
- 检查服务器日志，查看 VAD 是否检测到语音

### 识别结果不准确

- 确保在安静的环境中使用
- 说话清晰，语速适中
- 检查源语言设置是否正确

